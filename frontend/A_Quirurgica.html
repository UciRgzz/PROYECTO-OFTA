<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agenda Quir칰rgica</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css">

  <style>
    body { background: #f5f8ff; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .card { border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 25px; }
    .card-header { background: #2c3e50; color: white; font-weight: bold; }
    table th { background: #f0f2f5; }
    #calendar { max-width: 100%; margin: auto; }
  </style>
</head>
<body>
  <div class="container">
    <header class="mb-4">
      <h1 class="text-center"><i class="fas fa-calendar-check"></i> Agenda Quir칰rgica</h1>
    </header>

    <!-- Tabla de 칩rdenes -->
    <div class="card">
      <div class="card-header"><i class="fas fa-list"></i> 칍rdenes de Cirug칤a</div>
      <div class="card-body">
        <table class="table table-bordered table-striped text-center align-middle">
          <thead>
            <tr>
              <th>Expediente</th>
              <th>Edad</th>
              <th>Nombre</th>
              <th>Procedimiento</th>
              <th>Total Orden</th>
              <th>Pagos Realizados</th>
              <th>Diferencia</th>
              <th>Status</th>
              <th>Tipo de Lente</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaOrdenes">
            <!-- Se cargan desde la BD con JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Calendario -->
    <div class="card">
      <div class="card-header"><i class="fas fa-calendar"></i> Calendario de Cirug칤as</div>
      <div class="card-body">
        <div id="calendar"></div>
      </div>
    </div>
  </div>

  <!-- Librer칤as -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/js/all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <script>
    // ====================== TABLA ======================
    async function cargarOrdenes() {
      try {
        const res = await fetch('/api/ordenes'); // 游녣 Backend debe devolver las 칩rdenes
        const ordenes = await res.json();

        document.getElementById("tablaOrdenes").innerHTML = ordenes.map(o => `
          <tr>
            <td>${o.expediente}</td>
            <td>${o.edad}</td>
            <td>${o.nombre}</td>
            <td>${o.procedimiento}</td>
            <td>$${o.total}</td>
            <td>$${o.pagos}</td>
            <td>$${o.total - o.pagos}</td>
            <td>${o.status}</td>
            <td>${o.tipo_lente || '-'}</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="agendarCirugia(${o.id})">
                <i class="fas fa-calendar-plus"></i> Agendar
              </button>
            </td>
          </tr>
        `).join('');
      } catch (err) {
        console.error("Error cargando 칩rdenes:", err);
      }
    }

    // ====================== CALENDARIO ======================
    document.addEventListener('DOMContentLoaded', function () {
      let calendarEl = document.getElementById('calendar');
      let calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        selectable: true,
        locale: "es",
        dateClick: function(info) {
          alert("Asignar cirug칤a para el d칤a: " + info.dateStr);
          // Aqu칤 puedes abrir un modal para asignar paciente a ese d칤a
        },
        events: '/api/cirugias' // 游녣 Backend debe devolver las cirug칤as programadas
      });
      calendar.render();
    });

    cargarOrdenes();

    // Funci칩n para agendar desde la tabla
    function agendarCirugia(idOrden) {
      alert("Abrir modal para agendar la orden ID: " + idOrden);
      // Aqu칤 va un modal con select de fecha y tipo de lente
    }
  </script>
</body>
</html>
